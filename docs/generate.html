<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instant Quiz Generator — QuizMaster</title>
    <script>
        var THEMES={indigo:{label:'Indigo',primary:'#4f46e5',secondary:'#7c3aed',rgb:'99,102,241',palette:{50:'#eef2ff',100:'#e0e7ff',200:'#c7d2fe',300:'#a5b4fc',400:'#818cf8',500:'#6366f1',600:'#4f46e5',700:'#4338ca',800:'#3730a3',900:'#312e81'}},ocean:{label:'Ocean',primary:'#0284c7',secondary:'#06b6d4',rgb:'2,132,199',palette:{50:'#f0f9ff',100:'#e0f2fe',200:'#bae6fd',300:'#7dd3fc',400:'#38bdf8',500:'#0ea5e9',600:'#0284c7',700:'#0369a1',800:'#075985',900:'#0c4a6e'}},emerald:{label:'Emerald',primary:'#059669',secondary:'#10b981',rgb:'5,150,105',palette:{50:'#ecfdf5',100:'#d1fae5',200:'#a7f3d0',300:'#6ee7b7',400:'#34d399',500:'#10b981',600:'#059669',700:'#047857',800:'#065f46',900:'#064e3b'}},sunset:{label:'Sunset',primary:'#ea580c',secondary:'#f59e0b',rgb:'234,88,12',palette:{50:'#fff7ed',100:'#ffedd5',200:'#fed7aa',300:'#fdba74',400:'#fb923c',500:'#f97316',600:'#ea580c',700:'#c2410c',800:'#9a3412',900:'#7c2d12'}},rose:{label:'Rose',primary:'#e11d48',secondary:'#ec4899',rgb:'225,29,72',palette:{50:'#fff1f2',100:'#ffe4e6',200:'#fecdd3',300:'#fda4af',400:'#fb7185',500:'#f43f5e',600:'#e11d48',700:'#be123c',800:'#9f1239',900:'#881337'}},midnight:{label:'Midnight',primary:'#1e293b',secondary:'#475569',rgb:'30,41,59',palette:{50:'#f8fafc',100:'#f1f5f9',200:'#e2e8f0',300:'#cbd5e1',400:'#94a3b8',500:'#64748b',600:'#475569',700:'#334155',800:'#1e293b',900:'#0f172a'}}};
        var savedTheme=localStorage.getItem('qm-theme')||'indigo';
        var T=THEMES[savedTheme]||THEMES.indigo;
        var ds=document.documentElement.style;
        Object.entries(T.palette).forEach(function(e){ds.setProperty('--t-'+e[0],e[1])});
        ds.setProperty('--t-primary',T.primary);ds.setProperty('--t-secondary',T.secondary);ds.setProperty('--t-rgb',T.rgb);
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>tailwind.config={theme:{extend:{fontFamily:{sans:['Inter','sans-serif']},colors:{brand:T.palette,indigo:T.palette}}}}</script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/app.css">
</head>
<body class="bg-gray-50 min-h-screen flex flex-col">

<nav id="main-nav"></nav>

<div class="max-w-2xl mx-auto px-4 py-12">
    <div class="text-center mb-10">
        <div class="w-16 h-16 bg-amber-100 rounded-2xl flex items-center justify-center mx-auto mb-4 bounce-in">
            <i data-lucide="zap" class="w-8 h-8 text-amber-600"></i>
        </div>
        <h1 class="text-3xl md:text-4xl font-extrabold text-gray-800 mb-3">Instant Quiz Generator</h1>
        <p class="text-gray-500 text-lg">Pick a source, category, and difficulty — we'll generate a unique quiz in seconds!</p>
    </div>

    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-8 relative overflow-hidden">
        <div class="absolute top-0 left-0 right-0 h-1 gradient-warm"></div>

        <form id="generateForm" onsubmit="return handleGenerate(event)">
            <!-- Source Toggle -->
            <div class="mb-8">
                <label class="block text-sm font-bold text-gray-700 mb-3 flex items-center gap-1.5">
                    <i data-lucide="radio" class="w-4 h-4 text-indigo-500"></i> Question Source
                </label>
                <div class="grid grid-cols-2 gap-3">
                    <label class="cursor-pointer">
                        <input type="radio" name="source" value="online" class="hidden peer" checked>
                        <div class="peer-checked:ring-2 peer-checked:ring-blue-500 peer-checked:bg-blue-50 peer-checked:border-blue-300 bg-gray-50 border border-gray-200 rounded-xl p-4 text-center transition-all duration-200 hover:bg-gray-100 hover:border-gray-300">
                            <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center mx-auto mb-2"><i data-lucide="wifi" class="w-5 h-5 text-blue-600"></i></div>
                            <span class="text-sm font-bold text-blue-600 block">Online</span>
                            <span class="text-xs text-gray-400 block">Fresh from the internet</span>
                            <span class="text-xs text-emerald-500 font-medium flex items-center justify-center gap-1 mt-1"><i data-lucide="check" class="w-3 h-3"></i> Thousands of Qs</span>
                        </div>
                    </label>
                    <label class="cursor-pointer">
                        <input type="radio" name="source" value="offline" class="hidden peer">
                        <div class="peer-checked:ring-2 peer-checked:ring-purple-500 peer-checked:bg-purple-50 peer-checked:border-purple-300 bg-gray-50 border border-gray-200 rounded-xl p-4 text-center transition-all duration-200 hover:bg-gray-100 hover:border-gray-300">
                            <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center mx-auto mb-2"><i data-lucide="package" class="w-5 h-5 text-purple-600"></i></div>
                            <span class="text-sm font-bold text-purple-600 block">Offline</span>
                            <span class="text-xs text-gray-400 block">Built-in question bank</span>
                            <span class="text-xs text-gray-400 font-medium block mt-1">No internet needed</span>
                        </div>
                    </label>
                </div>
                <div id="onlineBadge" class="mt-3 bg-blue-50 border border-blue-200 rounded-lg p-3 text-xs text-blue-700 flex items-center gap-2">
                    <i data-lucide="globe" class="w-4 h-4 flex-shrink-0"></i>
                    <span>Powered by <strong>Open Trivia Database</strong> — thousands of community-verified questions!</span>
                </div>
                <div id="offlineBadge" class="mt-3 bg-purple-50 border border-purple-200 rounded-lg p-3 text-xs text-purple-700 items-center gap-2" style="display:none;">
                    <i data-lucide="package" class="w-4 h-4 flex-shrink-0"></i>
                    <span>Using 200 built-in questions across 10 categories. Works without internet!</span>
                </div>
            </div>

            <!-- Category -->
            <div class="mb-8">
                <label class="block text-sm font-bold text-gray-700 mb-3 flex items-center gap-1.5">
                    <i data-lucide="target" class="w-4 h-4 text-indigo-500"></i> Choose a Category
                </label>
                <div class="grid grid-cols-2 sm:grid-cols-3 gap-3" id="onlineCategoryGrid"></div>
                <div class="grid grid-cols-2 sm:grid-cols-3 gap-3 hidden" id="offlineCategoryGrid"></div>
            </div>

            <!-- Number of Questions -->
            <div class="mb-8">
                <label class="block text-sm font-bold text-gray-700 mb-3 flex items-center gap-1.5">
                    <i data-lucide="hash" class="w-4 h-4 text-indigo-500"></i>
                    Number of Questions: <span id="numDisplay" class="text-indigo-600">5</span>
                </label>
                <div class="relative">
                    <input type="range" name="num_questions" id="numQuestions" min="3" max="50" value="5"
                           class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-indigo-600">
                    <div class="flex justify-between text-xs text-gray-400 mt-1.5 px-1">
                        <span>3</span><span>Quick</span><span>15</span><span>Challenge</span><span id="maxLabel">50</span>
                    </div>
                </div>
            </div>

            <!-- Difficulty -->
            <div class="mb-8">
                <label class="block text-sm font-bold text-gray-700 mb-3 flex items-center gap-1.5">
                    <i data-lucide="gauge" class="w-4 h-4 text-indigo-500"></i> Difficulty Level
                </label>
                <div class="grid grid-cols-3 gap-3">
                    <label class="cursor-pointer">
                        <input type="radio" name="difficulty" value="easy" class="hidden peer">
                        <div class="peer-checked:ring-2 peer-checked:ring-emerald-500 peer-checked:bg-emerald-50 peer-checked:border-emerald-300 bg-gray-50 border border-gray-200 rounded-xl p-4 text-center transition-all duration-200 hover:bg-gray-100 hover:border-gray-300">
                            <div class="w-8 h-8 bg-emerald-100 rounded-lg flex items-center justify-center mx-auto mb-2"><span class="w-3 h-3 rounded-full bg-emerald-500"></span></div>
                            <span class="text-sm font-bold text-emerald-600">Easy</span><span class="text-xs text-gray-400 block">30s per Q</span>
                        </div>
                    </label>
                    <label class="cursor-pointer">
                        <input type="radio" name="difficulty" value="medium" class="hidden peer" checked>
                        <div class="peer-checked:ring-2 peer-checked:ring-amber-500 peer-checked:bg-amber-50 peer-checked:border-amber-300 bg-gray-50 border border-gray-200 rounded-xl p-4 text-center transition-all duration-200 hover:bg-gray-100 hover:border-gray-300">
                            <div class="w-8 h-8 bg-amber-100 rounded-lg flex items-center justify-center mx-auto mb-2"><span class="w-3 h-3 rounded-full bg-amber-500"></span></div>
                            <span class="text-sm font-bold text-amber-600">Medium</span><span class="text-xs text-gray-400 block">20s per Q</span>
                        </div>
                    </label>
                    <label class="cursor-pointer">
                        <input type="radio" name="difficulty" value="hard" class="hidden peer">
                        <div class="peer-checked:ring-2 peer-checked:ring-red-500 peer-checked:bg-red-50 peer-checked:border-red-300 bg-gray-50 border border-gray-200 rounded-xl p-4 text-center transition-all duration-200 hover:bg-gray-100 hover:border-gray-300">
                            <div class="w-8 h-8 bg-red-100 rounded-lg flex items-center justify-center mx-auto mb-2"><span class="w-3 h-3 rounded-full bg-red-500"></span></div>
                            <span class="text-sm font-bold text-red-600">Hard</span><span class="text-xs text-gray-400 block">15s per Q</span>
                        </div>
                    </label>
                </div>
            </div>

            <!-- Preview -->
            <div id="previewBox" class="bg-gradient-to-r from-indigo-50 to-indigo-100 border border-indigo-200 rounded-xl p-5 mb-8 hidden">
                <h3 class="font-bold text-indigo-800 text-sm mb-3 flex items-center gap-1.5">
                    <i data-lucide="eye" class="w-4 h-4"></i> Your Quiz Preview
                </h3>
                <div class="grid grid-cols-2 sm:grid-cols-4 gap-3 text-center">
                    <div><div class="w-8 h-8 bg-white rounded-lg flex items-center justify-center mx-auto mb-1 shadow-sm"><i data-lucide="wifi" id="previewSourceIcon" class="w-4 h-4 text-blue-500"></i></div><span class="text-xs text-gray-500" id="previewSource">Online</span></div>
                    <div><div class="w-8 h-8 bg-white rounded-lg flex items-center justify-center mx-auto mb-1 shadow-sm"><i data-lucide="book-open" id="previewCatIcon" class="w-4 h-4 text-indigo-500"></i></div><span class="text-xs text-gray-500" id="previewCat">—</span></div>
                    <div><span class="text-lg font-bold text-indigo-600 block" id="previewNum">5</span><span class="text-xs text-gray-500">Questions</span></div>
                    <div><div class="w-6 h-6 rounded-full mx-auto mb-1" id="previewDiffDot" style="background:#f59e0b;"></div><span class="text-xs text-gray-500" id="previewDiff">Medium</span></div>
                </div>
            </div>

            <!-- Submit -->
            <button type="submit" id="generateBtn"
                    class="w-full gradient-warm text-white font-bold py-4 px-8 rounded-xl text-lg hover:opacity-90 transform hover:scale-[1.01] transition-all duration-200 shadow-lg hover:shadow-xl flex items-center justify-center gap-3">
                <i data-lucide="zap" class="w-5 h-5"></i>
                <span>Generate Quiz Instantly</span>
            </button>
        </form>
    </div>

    <div class="text-center mt-8 text-gray-400 text-sm space-y-1.5">
        <p class="flex items-center justify-center gap-1"><i data-lucide="wifi" class="w-3.5 h-3.5"></i> <strong>Online mode</strong> fetches from <a href="https://opentdb.com" target="_blank" class="underline hover:text-indigo-500">Open Trivia Database</a></p>
        <p class="flex items-center justify-center gap-1"><i data-lucide="package" class="w-3.5 h-3.5"></i> <strong>Offline mode</strong> uses 200 built-in questions</p>
        <p class="flex items-center justify-center gap-1"><i data-lucide="lightbulb" class="w-3.5 h-3.5"></i> If online fails, we automatically fall back to offline</p>
    </div>
</div>

<footer id="main-footer"></footer>

<script src="js/question-bank.js"></script>
<script src="js/app.js"></script>
<script>
const onlineIcons = {'General Knowledge':'lightbulb','Science & Nature':'flask-conical','Science: Computers':'cpu','Mathematics':'calculator','History':'landmark','Geography':'globe','Movies':'clapperboard','Music':'music','Television':'tv','Video Games':'gamepad-2','Sports':'medal','Animals':'paw-print','Mythology':'swords','Art':'palette','Celebrities':'star','Vehicles':'car','Comics':'book-open','Anime & Manga':'sparkles','Cartoons':'smile'};
const offlineIcons = {'Science':'flask-conical','History':'landmark','Geography':'globe','Movies':'clapperboard','Technology':'monitor','Sports':'medal','Music':'music','Food':'utensils','Animals':'paw-print','General Knowledge':'lightbulb'};
const diffColors = {easy:'#10b981',medium:'#f59e0b',hard:'#ef4444'};
const diffLabels = {easy:'Easy', medium:'Medium', hard:'Hard'};
const timePer = {easy:30, medium:20, hard:15};

function pageInit() {
    // Build online categories
    const onlineGrid = document.getElementById('onlineCategoryGrid');
    const onlineCats = getOnlineCategories();
    let onlineHtml = '';
    onlineCats.forEach(cat => {
        const icon = onlineIcons[cat] || 'book-open';
        onlineHtml += `<label class="category-card relative cursor-pointer">
            <input type="radio" name="category" value="${cat}" class="hidden peer online-cat" data-max="50">
            <div class="peer-checked:ring-2 peer-checked:ring-indigo-500 peer-checked:bg-indigo-50 peer-checked:border-indigo-300 bg-gray-50 border border-gray-200 rounded-xl p-3 text-center transition-all duration-200 hover:bg-gray-100 hover:border-gray-300 hover:shadow-sm">
                <div class="w-9 h-9 bg-indigo-100 rounded-lg flex items-center justify-center mx-auto mb-1.5"><i data-lucide="${icon}" class="w-4.5 h-4.5 text-indigo-600"></i></div>
                <span class="text-xs font-semibold text-gray-700 block leading-tight">${cat}</span>
                <span class="text-xs text-blue-400 flex items-center justify-center gap-0.5 mt-0.5"><i data-lucide="wifi" class="w-2.5 h-2.5"></i> Online</span>
            </div></label>`;
    });
    onlineGrid.innerHTML = onlineHtml;

    // Build offline categories
    const offlineGrid = document.getElementById('offlineCategoryGrid');
    const offlineCats = getOfflineCategories();
    const availCounts = getOfflineAvailableCounts();
    let offlineHtml = '';
    offlineCats.forEach(cat => {
        const icon = offlineIcons[cat] || 'book-open';
        const count = availCounts[cat] || 20;
        offlineHtml += `<label class="category-card relative cursor-pointer">
            <input type="radio" name="category" value="${cat}" class="hidden peer offline-cat" data-max="${count}">
            <div class="peer-checked:ring-2 peer-checked:ring-indigo-500 peer-checked:bg-indigo-50 peer-checked:border-indigo-300 bg-gray-50 border border-gray-200 rounded-xl p-4 text-center transition-all duration-200 hover:bg-gray-100 hover:border-gray-300 hover:shadow-sm">
                <div class="w-9 h-9 bg-indigo-100 rounded-lg flex items-center justify-center mx-auto mb-1.5"><i data-lucide="${icon}" class="w-4.5 h-4.5 text-indigo-600"></i></div>
                <span class="text-sm font-semibold text-gray-700 block">${cat}</span>
                <span class="text-xs text-gray-400">${count} Qs</span>
            </div></label>`;
    });
    offlineGrid.innerHTML = offlineHtml;

    // Source toggle
    const slider = document.getElementById('numQuestions');
    const numDisplay = document.getElementById('numDisplay');
    const maxLabel = document.getElementById('maxLabel');

    document.querySelectorAll('input[name="source"]').forEach(input => {
        input.addEventListener('change', function() {
            const isOnline = this.value === 'online';
            document.getElementById('onlineCategoryGrid').classList.toggle('hidden', !isOnline);
            document.getElementById('offlineCategoryGrid').classList.toggle('hidden', isOnline);
            document.getElementById('onlineBadge').style.display = isOnline ? 'flex' : 'none';
            document.getElementById('offlineBadge').style.display = isOnline ? 'none' : 'flex';
            document.querySelectorAll('input[name="category"]').forEach(c => c.checked = false);
            slider.max = isOnline ? 50 : 20;
            maxLabel.textContent = isOnline ? '50' : '20';
            if (!isOnline && parseInt(slider.value) > 20) { slider.value = 20; numDisplay.textContent = '20'; }
            updatePreview();
            lucide.createIcons();
        });
    });

    slider.addEventListener('input', function() { numDisplay.textContent = this.value; updatePreview(); });

    document.addEventListener('change', function(e) {
        if (e.target.name === 'category') {
            const max = parseInt(e.target.dataset.max);
            slider.max = max; maxLabel.textContent = max;
            if (parseInt(slider.value) > max) { slider.value = max; numDisplay.textContent = max; }
            updatePreview();
        }
    });

    document.querySelectorAll('input[name="difficulty"]').forEach(input => input.addEventListener('change', updatePreview));

    lucide.createIcons();
    updatePreview();
}

function updatePreview() {
    const selCat = document.querySelector('input[name="category"]:checked');
    const selDiff = document.querySelector('input[name="difficulty"]:checked');
    const selSrc = document.querySelector('input[name="source"]:checked');
    const previewBox = document.getElementById('previewBox');

    if (selCat) {
        previewBox.classList.remove('hidden');
        const isOnline = selSrc && selSrc.value === 'online';
        const srcIcon = document.getElementById('previewSourceIcon');
        srcIcon.setAttribute('data-lucide', isOnline ? 'wifi' : 'package');
        document.getElementById('previewSource').textContent = isOnline ? 'Online' : 'Offline';

        const allIcons = isOnline ? onlineIcons : offlineIcons;
        document.getElementById('previewCatIcon').setAttribute('data-lucide', allIcons[selCat.value] || 'book-open');
        document.getElementById('previewCat').textContent = selCat.value;
        document.getElementById('previewNum').textContent = document.getElementById('numQuestions').value;

        if (selDiff) {
            document.getElementById('previewDiffDot').style.background = diffColors[selDiff.value];
            document.getElementById('previewDiff').textContent = diffLabels[selDiff.value];
        }
        lucide.createIcons();
    }
}

let generateConfirmed = false;
function handleGenerate(e) {
    e.preventDefault();
    const selCat = document.querySelector('input[name="category"]:checked');
    const selDiff = document.querySelector('input[name="difficulty"]:checked');
    const selSrc = document.querySelector('input[name="source"]:checked');

    if (!selCat) {
        showAlert('target', 'amber', 'Pick a Category', 'Please select a category before generating your quiz.', 'OK', 'modal-btn-warning');
        return false;
    }

    if (!generateConfirmed) {
        const isOnline = selSrc && selSrc.value === 'online';
        showConfirm('zap', 'purple', 'Generate Quiz?',
            '<strong>' + selCat.value + '</strong> — ' + document.getElementById('numQuestions').value + ' questions (' + (selDiff ? diffLabels[selDiff.value] : 'Medium') + ')<br>Source: ' + (isOnline ? 'Online' : 'Offline') + '<br><br>A new quiz will be created for you!',
            'Generate', 'modal-btn-success',
            function() { generateConfirmed = true; doGenerate(); }
        );
        return false;
    }
    doGenerate();
    return false;
}

async function doGenerate() {
    const selCat = document.querySelector('input[name="category"]:checked');
    const selDiff = document.querySelector('input[name="difficulty"]:checked');
    const selSrc = document.querySelector('input[name="source"]:checked');
    const numQ = parseInt(document.getElementById('numQuestions').value);
    const difficulty = selDiff ? selDiff.value : 'medium';
    const category = selCat.value;
    const isOnline = selSrc && selSrc.value === 'online';

    const btn = document.getElementById('generateBtn');
    btn.innerHTML = '<svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> <span>' + (isOnline ? 'Fetching questions...' : 'Generating quiz...') + '</span>';
    btn.disabled = true;

    try {
        let questions;
        if (isOnline) {
            questions = await smartFetch(category, numQ, difficulty);
        } else {
            questions = getOfflineQuestions(category, numQ);
        }

        if (!questions || questions.length === 0) {
            showAlert('alert-triangle', 'red', 'No Questions Found', 'Could not fetch questions for this category. Try a different category or use offline mode.', 'OK', 'modal-btn-danger');
            btn.innerHTML = '<i data-lucide="zap" class="w-5 h-5"></i><span>Generate Quiz Instantly</span>';
            btn.disabled = false;
            lucide.createIcons();
            return;
        }

        const timePerQ = timePer[difficulty] || 20;
        const quiz = DB.saveQuiz({
            title: category + ' Challenge',
            description: 'Auto-generated ' + difficulty + ' quiz with ' + questions.length + ' questions from ' + (isOnline ? 'Open Trivia Database' : 'our built-in question bank') + '.',
            category: category,
            difficulty: difficulty,
            time_per_question: timePerQ,
            questions: questions,
        });

        showToast('Quiz generated successfully!', 'success');
        setTimeout(() => { window.location.href = 'quiz.html?id=' + quiz.id; }, 600);
    } catch (err) {
        console.error(err);
        showAlert('alert-triangle', 'red', 'Generation Failed', 'Something went wrong: ' + err.message + '<br>Try again or switch to offline mode.', 'OK', 'modal-btn-danger');
        btn.innerHTML = '<i data-lucide="zap" class="w-5 h-5"></i><span>Generate Quiz Instantly</span>';
        btn.disabled = false;
        lucide.createIcons();
    }
}
</script>
</body>
</html>
