<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz — QuizMaster</title>
    <script>
        var THEMES={indigo:{label:'Indigo',primary:'#4f46e5',secondary:'#7c3aed',rgb:'99,102,241',palette:{50:'#eef2ff',100:'#e0e7ff',200:'#c7d2fe',300:'#a5b4fc',400:'#818cf8',500:'#6366f1',600:'#4f46e5',700:'#4338ca',800:'#3730a3',900:'#312e81'}},ocean:{label:'Ocean',primary:'#0284c7',secondary:'#06b6d4',rgb:'2,132,199',palette:{50:'#f0f9ff',100:'#e0f2fe',200:'#bae6fd',300:'#7dd3fc',400:'#38bdf8',500:'#0ea5e9',600:'#0284c7',700:'#0369a1',800:'#075985',900:'#0c4a6e'}},emerald:{label:'Emerald',primary:'#059669',secondary:'#10b981',rgb:'5,150,105',palette:{50:'#ecfdf5',100:'#d1fae5',200:'#a7f3d0',300:'#6ee7b7',400:'#34d399',500:'#10b981',600:'#059669',700:'#047857',800:'#065f46',900:'#064e3b'}},sunset:{label:'Sunset',primary:'#ea580c',secondary:'#f59e0b',rgb:'234,88,12',palette:{50:'#fff7ed',100:'#ffedd5',200:'#fed7aa',300:'#fdba74',400:'#fb923c',500:'#f97316',600:'#ea580c',700:'#c2410c',800:'#9a3412',900:'#7c2d12'}},rose:{label:'Rose',primary:'#e11d48',secondary:'#ec4899',rgb:'225,29,72',palette:{50:'#fff1f2',100:'#ffe4e6',200:'#fecdd3',300:'#fda4af',400:'#fb7185',500:'#f43f5e',600:'#e11d48',700:'#be123c',800:'#9f1239',900:'#881337'}},midnight:{label:'Midnight',primary:'#1e293b',secondary:'#475569',rgb:'30,41,59',palette:{50:'#f8fafc',100:'#f1f5f9',200:'#e2e8f0',300:'#cbd5e1',400:'#94a3b8',500:'#64748b',600:'#475569',700:'#334155',800:'#1e293b',900:'#0f172a'}}};
        var savedTheme=localStorage.getItem('qm-theme')||'indigo';
        var T=THEMES[savedTheme]||THEMES.indigo;
        var ds=document.documentElement.style;
        Object.entries(T.palette).forEach(function(e){ds.setProperty('--t-'+e[0],e[1])});
        ds.setProperty('--t-primary',T.primary);ds.setProperty('--t-secondary',T.secondary);ds.setProperty('--t-rgb',T.rgb);
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>tailwind.config={theme:{extend:{fontFamily:{sans:['Inter','sans-serif']},colors:{brand:T.palette,indigo:T.palette}}}}</script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/app.css">
</head>
<body class="bg-gray-50 min-h-screen flex flex-col">

<nav id="main-nav"></nav>

<div id="page-content"></div>

<footer id="main-footer"></footer>

<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-database-compat.js"></script>
<script src="js/firebase-sync.js"></script>
<script src="js/question-bank.js"></script>
<script src="js/app.js"></script>
<script>
function pageInit() {
    const quizId = getUrlParam('id');
    const quiz = DB.getQuiz(quizId);
    if (!quiz) {
        document.getElementById('page-content').innerHTML = '<div class="text-center py-20"><h2 class="text-2xl font-bold text-gray-600">Quiz not found</h2><a href="quizzes.html" class="text-indigo-600 mt-4 inline-block">Back to Quizzes</a></div>';
        return;
    }

    const icon = getCategoryIcon(quiz.category);
    const diffColor = getDifficultyColor(quiz.difficulty);
    const qCount = (quiz.questions || []).length;
    const attempts = DB.getAttemptsForQuiz(quiz.id);
    const topScores = attempts.sort((a, b) => b.score - a.score || a.time_taken - b.time_taken).slice(0, 5);

    document.title = quiz.title + ' — QuizMaster';

    let topScoresHtml = '';
    if (topScores.length > 0) {
        let rows = '';
        topScores.forEach((attempt, i) => {
            const rankClass = i === 0 ? 'bg-amber-400 text-white' : (i === 1 ? 'bg-gray-300 text-white' : (i === 2 ? 'bg-orange-400 text-white' : 'bg-gray-200 text-gray-500'));
            const rowBg = i === 0 ? 'bg-amber-50 border border-amber-200' : 'bg-gray-50 border border-gray-100';
            rows += `
            <div class="flex items-center justify-between p-4 rounded-xl ${rowBg}">
                <div class="flex items-center gap-4">
                    <div class="w-9 h-9 rounded-full flex items-center justify-center text-sm font-bold ${rankClass}">${i + 1}</div>
                    <div>
                        <div class="font-semibold text-gray-800">${escapeHtml(attempt.player_name)}</div>
                        <div class="text-xs text-gray-400">${timeAgo(attempt.created_at)}</div>
                    </div>
                </div>
                <div class="text-right">
                    <div class="text-lg font-bold text-indigo-700">${attempt.score}/${attempt.total_points}</div>
                    <div class="text-xs text-gray-400 flex items-center gap-1 justify-end">
                        <i data-lucide="clock" class="w-3 h-3"></i> ${attempt.time_taken}s
                    </div>
                </div>
            </div>`;
        });
        topScoresHtml = `
        <div class="mt-8 bg-white rounded-xl shadow-sm border border-gray-100 p-8 fade-in">
            <h2 class="text-xl font-bold text-gray-800 mb-6 flex items-center gap-2">
                <i data-lucide="trophy" class="w-5 h-5 text-amber-500"></i> Top Scores
            </h2>
            <div class="space-y-3">${rows}</div>
        </div>`;
    }

    document.getElementById('page-content').innerHTML = `
    <div class="max-w-4xl mx-auto px-4 py-12">
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden fade-in">
            <div class="gradient-bg p-6 md:p-10 text-white text-center relative">
                <div class="w-16 h-16 bg-white/15 rounded-2xl flex items-center justify-center mx-auto mb-4">
                    <i data-lucide="${icon}" class="w-8 h-8"></i>
                </div>
                <h1 class="text-3xl md:text-4xl font-extrabold mb-2">${escapeHtml(quiz.title)}</h1>
                <p class="text-indigo-200 text-lg max-w-lg mx-auto">${escapeHtml(quiz.description)}</p>
            </div>
            <div class="p-8">
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                    <div class="text-center p-4 bg-indigo-50 rounded-xl border border-indigo-100">
                        <div class="w-10 h-10 bg-indigo-100 rounded-lg flex items-center justify-center mx-auto mb-2">
                            <i data-lucide="file-text" class="w-5 h-5 text-indigo-600"></i>
                        </div>
                        <div class="text-2xl font-bold text-indigo-700">${qCount}</div>
                        <div class="text-xs text-gray-500">Questions</div>
                    </div>
                    <div class="text-center p-4 bg-blue-50 rounded-xl border border-blue-100">
                        <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center mx-auto mb-2">
                            <i data-lucide="clock" class="w-5 h-5 text-blue-600"></i>
                        </div>
                        <div class="text-2xl font-bold text-blue-700">${quiz.time_per_question}s</div>
                        <div class="text-xs text-gray-500">Per Question</div>
                    </div>
                    <div class="text-center p-4 bg-${diffColor}-50 rounded-xl border border-${diffColor}-100">
                        <div class="w-10 h-10 bg-${diffColor}-100 rounded-lg flex items-center justify-center mx-auto mb-2">
                            <i data-lucide="gauge" class="w-5 h-5 text-${diffColor}-600"></i>
                        </div>
                        <div class="text-2xl font-bold text-${diffColor}-700 capitalize">${quiz.difficulty}</div>
                        <div class="text-xs text-gray-500">Difficulty</div>
                    </div>
                    <div class="text-center p-4 bg-amber-50 rounded-xl border border-amber-100">
                        <div class="w-10 h-10 bg-amber-100 rounded-lg flex items-center justify-center mx-auto mb-2">
                            <i data-lucide="users" class="w-5 h-5 text-amber-600"></i>
                        </div>
                        <div class="text-2xl font-bold text-amber-700">${attempts.length}</div>
                        <div class="text-xs text-gray-500">Attempts</div>
                    </div>
                </div>
                <div class="text-center">
                    <button onclick="confirmStart()"
                       class="inline-flex items-center gap-2 gradient-bg text-white px-10 py-4 rounded-xl font-bold text-lg hover:opacity-90 transition pulse-glow cursor-pointer shadow-lg">
                        <i data-lucide="play" class="w-5 h-5"></i> Start Quiz Now
                    </button>
                    <p class="text-gray-400 text-sm mt-3">Good luck! You've got this.</p>
                </div>
            </div>
        </div>
        ${topScoresHtml}
        <div class="text-center mt-8">
            <a href="quizzes.html" class="inline-flex items-center gap-1 text-indigo-600 hover:text-indigo-800 font-medium text-sm">
                <i data-lucide="arrow-left" class="w-4 h-4"></i> Back to All Quizzes
            </a>
        </div>
    </div>`;
    lucide.createIcons();

    window._quiz = quiz;
}

function confirmStart() {
    const quiz = window._quiz;
    const qCount = (quiz.questions || []).length;
    showConfirm(
        'play', 'green', 'Ready to Start?',
        '<strong>' + escapeHtml(quiz.title) + '</strong><br><br>' +
        qCount + ' questions<br>' +
        quiz.time_per_question + 's per question<br>' +
        quiz.difficulty.charAt(0).toUpperCase() + quiz.difficulty.slice(1) + ' difficulty<br><br>' +
        'Once you start, the timer begins immediately!',
        "Let's Go!", 'modal-btn-success',
        function() { window.location.href = 'play.html?id=' + quiz.id; }
    );
}
</script>
</body>
</html>
