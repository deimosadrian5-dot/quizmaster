<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leaderboard â€” QuizMaster</title>
    <script>
        var THEMES={indigo:{label:'Indigo',primary:'#4f46e5',secondary:'#7c3aed',rgb:'99,102,241',palette:{50:'#eef2ff',100:'#e0e7ff',200:'#c7d2fe',300:'#a5b4fc',400:'#818cf8',500:'#6366f1',600:'#4f46e5',700:'#4338ca',800:'#3730a3',900:'#312e81'}},ocean:{label:'Ocean',primary:'#0284c7',secondary:'#06b6d4',rgb:'2,132,199',palette:{50:'#f0f9ff',100:'#e0f2fe',200:'#bae6fd',300:'#7dd3fc',400:'#38bdf8',500:'#0ea5e9',600:'#0284c7',700:'#0369a1',800:'#075985',900:'#0c4a6e'}},emerald:{label:'Emerald',primary:'#059669',secondary:'#10b981',rgb:'5,150,105',palette:{50:'#ecfdf5',100:'#d1fae5',200:'#a7f3d0',300:'#6ee7b7',400:'#34d399',500:'#10b981',600:'#059669',700:'#047857',800:'#065f46',900:'#064e3b'}},sunset:{label:'Sunset',primary:'#ea580c',secondary:'#f59e0b',rgb:'234,88,12',palette:{50:'#fff7ed',100:'#ffedd5',200:'#fed7aa',300:'#fdba74',400:'#fb923c',500:'#f97316',600:'#ea580c',700:'#c2410c',800:'#9a3412',900:'#7c2d12'}},rose:{label:'Rose',primary:'#e11d48',secondary:'#ec4899',rgb:'225,29,72',palette:{50:'#fff1f2',100:'#ffe4e6',200:'#fecdd3',300:'#fda4af',400:'#fb7185',500:'#f43f5e',600:'#e11d48',700:'#be123c',800:'#9f1239',900:'#881337'}},midnight:{label:'Midnight',primary:'#1e293b',secondary:'#475569',rgb:'30,41,59',palette:{50:'#f8fafc',100:'#f1f5f9',200:'#e2e8f0',300:'#cbd5e1',400:'#94a3b8',500:'#64748b',600:'#475569',700:'#334155',800:'#1e293b',900:'#0f172a'}}};
        var savedTheme=localStorage.getItem('qm-theme')||'indigo';
        var T=THEMES[savedTheme]||THEMES.indigo;
        var ds=document.documentElement.style;
        Object.entries(T.palette).forEach(function(e){ds.setProperty('--t-'+e[0],e[1])});
        ds.setProperty('--t-primary',T.primary);ds.setProperty('--t-secondary',T.secondary);ds.setProperty('--t-rgb',T.rgb);
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>tailwind.config={theme:{extend:{fontFamily:{sans:['Inter','sans-serif']},colors:{brand:T.palette,indigo:T.palette}}}}</script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/app.css">
</head>
<body class="bg-gray-50 min-h-screen flex flex-col">

<nav id="main-nav"></nav>
<div id="page-content"></div>
<footer id="main-footer"></footer>

<script src="js/question-bank.js"></script>
<script src="js/app.js"></script>
<script>
function pageInit() {
    const filterQuizId = getUrlParam('quiz') ? parseInt(getUrlParam('quiz')) : null;
    const quizzes = DB.getQuizzes();
    let attempts = DB.getAttempts();

    // Sort attempts by score desc, then time asc
    attempts.sort((a, b) => b.score - a.score || a.time_taken - b.time_taken);

    if (filterQuizId) {
        attempts = attempts.filter(a => a.quiz_id === filterQuizId);
    }

    // Build filter buttons
    let filterHtml = '<a href="leaderboard.html" class="inline-flex items-center gap-1.5 px-4 py-2 rounded-full text-sm font-medium transition ' +
        (!filterQuizId ? 'bg-indigo-600 text-white' : 'bg-gray-100 text-gray-600 hover:bg-gray-200') + '">' +
        '<i data-lucide="layers" class="w-3.5 h-3.5"></i> All Quizzes</a>';
    quizzes.forEach(q => {
        const active = filterQuizId === q.id;
        filterHtml += '<a href="leaderboard.html?quiz=' + q.id + '" class="px-4 py-2 rounded-full text-sm font-medium transition ' +
            (active ? 'bg-indigo-600 text-white' : 'bg-gray-100 text-gray-600 hover:bg-gray-200') + '">' +
            escapeHtml(q.title) + '</a>';
    });

    let contentHtml = '';
    if (attempts.length === 0) {
        contentHtml = `<div class="text-center py-16">
            <div class="w-16 h-16 bg-gray-100 rounded-2xl flex items-center justify-center mx-auto mb-4">
                <i data-lucide="target" class="w-8 h-8 text-gray-400"></i>
            </div>
            <h2 class="text-2xl font-bold text-gray-600 mt-2">No scores yet!</h2>
            <p class="text-gray-400 mt-2">Be the first to take a quiz and claim the top spot!</p>
            <a href="quizzes.html" class="inline-flex items-center gap-2 mt-6 gradient-bg text-white px-6 py-3 rounded-xl font-bold hover:opacity-90 transition text-sm">
                Take a Quiz <i data-lucide="arrow-right" class="w-4 h-4"></i>
            </a>
        </div>`;
    } else {
        // Podium (top 3)
        let podiumHtml = '';
        if (attempts.length >= 3) {
            const getQuizTitle = (qid) => { const q = quizzes.find(x => x.id === qid); return q ? q.title : ''; };
            const top = attempts.slice(0, 3);
            podiumHtml = `
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-10 items-end">
                <div class="text-center fade-in order-2 sm:order-1">
                    <div class="w-12 h-12 bg-gray-300 rounded-full flex items-center justify-center text-white mx-auto mb-3 shadow-md"><span class="text-lg font-bold">2</span></div>
                    <div class="bg-gray-100 rounded-xl sm:rounded-t-xl sm:rounded-b-none p-4 border border-gray-200 sm:h-[120px]">
                        <div class="font-bold text-gray-700 text-sm">${escapeHtml(top[1].player_name)}</div>
                        <div class="text-xl sm:text-2xl font-extrabold text-gray-600">${top[1].score}</div>
                        <div class="text-xs text-gray-400 mt-1 truncate">${escapeHtml(getQuizTitle(top[1].quiz_id))}</div>
                    </div>
                </div>
                <div class="text-center fade-in order-1 sm:order-2">
                    <div class="w-14 h-14 bg-amber-400 rounded-full flex items-center justify-center text-white mx-auto mb-3 shadow-lg"><i data-lucide="crown" class="w-7 h-7"></i></div>
                    <div class="gradient-bg rounded-xl sm:rounded-t-xl sm:rounded-b-none p-4 text-white sm:h-[160px]">
                        <div class="font-bold text-sm">${escapeHtml(top[0].player_name)}</div>
                        <div class="text-2xl sm:text-3xl font-extrabold">${top[0].score}</div>
                        <div class="text-xs text-indigo-200 mt-1 truncate">${escapeHtml(getQuizTitle(top[0].quiz_id))}</div>
                    </div>
                </div>
                <div class="text-center fade-in order-3">
                    <div class="w-12 h-12 bg-orange-400 rounded-full flex items-center justify-center text-white mx-auto mb-3 shadow-md"><span class="text-lg font-bold">3</span></div>
                    <div class="bg-orange-50 rounded-xl sm:rounded-t-xl sm:rounded-b-none p-4 border border-orange-200 sm:h-[100px]">
                        <div class="font-bold text-orange-700 text-sm">${escapeHtml(top[2].player_name)}</div>
                        <div class="text-xl sm:text-2xl font-extrabold text-orange-600">${top[2].score}</div>
                        <div class="text-xs text-orange-400 mt-1 truncate">${escapeHtml(getQuizTitle(top[2].quiz_id))}</div>
                    </div>
                </div>
            </div>`;
        }

        // Table
        let rowsHtml = '';
        attempts.forEach((attempt, i) => {
            const quiz = quizzes.find(q => q.id === attempt.quiz_id);
            const quizTitle = quiz ? quiz.title : 'Unknown';
            const percentage = attempt.total_points > 0 ? Math.round((attempt.score / attempt.total_points) * 100) : 0;
            const pctClass = percentage >= 70 ? 'bg-emerald-100 text-emerald-700' : (percentage >= 40 ? 'bg-amber-100 text-amber-700' : 'bg-red-100 text-red-700');

            let rankCell;
            if (i === 0) rankCell = '<span class="w-8 h-8 bg-amber-400 rounded-full flex items-center justify-center text-white font-bold text-xs">1</span>';
            else if (i === 1) rankCell = '<span class="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center text-white font-bold text-xs">2</span>';
            else if (i === 2) rankCell = '<span class="w-8 h-8 bg-orange-400 rounded-full flex items-center justify-center text-white font-bold text-xs">3</span>';
            else rankCell = '<span class="text-gray-400 font-bold text-sm pl-2">' + (i + 1) + '</span>';

            rowsHtml += `<tr class="hover:bg-gray-50 transition ${i < 3 ? 'bg-amber-50/30' : ''}">
                <td class="px-3 md:px-6 py-4">${rankCell}</td>
                <td class="px-3 md:px-6 py-4">
                    <div class="font-semibold text-gray-800 text-sm">${escapeHtml(attempt.player_name)}</div>
                    <div class="text-xs text-gray-400">${timeAgo(attempt.created_at)}</div>
                </td>
                <td class="px-3 md:px-6 py-4 text-sm text-gray-600">${escapeHtml(quizTitle)}</td>
                <td class="px-3 md:px-6 py-4 text-center">
                    <span class="font-bold text-indigo-700">${attempt.score}</span>
                    <span class="text-gray-400 text-xs">/${attempt.total_points}</span>
                </td>
                <td class="px-3 md:px-6 py-4 text-center">
                    <span class="inline-block px-2.5 py-1 rounded-full text-xs font-bold ${pctClass}">${percentage}%</span>
                </td>
                <td class="px-3 md:px-6 py-4 text-center text-sm text-gray-500">
                    <div class="flex items-center justify-center gap-1"><i data-lucide="clock" class="w-3 h-3"></i> ${attempt.time_taken}s</div>
                </td>
            </tr>`;
        });

        contentHtml = podiumHtml + `
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-x-auto">
            <table class="w-full min-w-[600px]">
                <thead class="bg-gray-50 border-b border-gray-100">
                    <tr>
                        <th class="px-3 md:px-6 py-3.5 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Rank</th>
                        <th class="px-3 md:px-6 py-3.5 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Player</th>
                        <th class="px-3 md:px-6 py-3.5 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Quiz</th>
                        <th class="px-3 md:px-6 py-3.5 text-center text-xs font-bold text-gray-500 uppercase tracking-wider">Score</th>
                        <th class="px-3 md:px-6 py-3.5 text-center text-xs font-bold text-gray-500 uppercase tracking-wider">Accuracy</th>
                        <th class="px-3 md:px-6 py-3.5 text-center text-xs font-bold text-gray-500 uppercase tracking-wider">Time</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-50">${rowsHtml}</tbody>
            </table>
        </div>`;
    }

    document.getElementById('page-content').innerHTML = `
    <div class="max-w-4xl mx-auto px-4 py-12">
        <div class="text-center mb-10">
            <div class="w-16 h-16 bg-amber-100 rounded-2xl flex items-center justify-center mx-auto mb-4">
                <i data-lucide="trophy" class="w-8 h-8 text-amber-600"></i>
            </div>
            <h1 class="text-3xl md:text-4xl font-extrabold text-gray-800 mb-2">Leaderboard</h1>
            <p class="text-gray-500">The best quiz masters of all time!</p>
        </div>
        <div class="flex flex-wrap justify-center gap-2 mb-8">${filterHtml}</div>
        ${contentHtml}
    </div>`;

    lucide.createIcons();
}
</script>
</body>
</html>
